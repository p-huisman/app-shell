var le=Object.defineProperty;var he=(e,t,r)=>t in e?le(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var fe=(e=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(e,{get:(t,r)=>(typeof require!="undefined"?require:t)[r]}):e)(function(e){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var w=(e,t,r)=>he(e,typeof t!="symbol"?t+"":t,r);var h=(e,t,r)=>new Promise((n,a)=>{var o=c=>{try{i(r.next(c))}catch(l){a(l)}},s=c=>{try{i(r.throw(c))}catch(l){a(l)}},i=c=>c.done?n(c.value):Promise.resolve(c.value).then(o,s);i((r=r.apply(e,t)).next())});import U from"react";import nt from"react-dom";function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?H(Object(r),!0).forEach(function(n){me(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function I(e){return(I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function me(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function A(e){return(A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function L(e,t){var r;if(typeof(r=t.domElement?function(){return t.domElement}:t.domElementGetter?t.domElementGetter:e.domElementGetter?e.domElementGetter:function(n){var a=n.appName||n.name;if(!a)throw Error("single-spa's dom-element-getter-helpers was not given an application name as a prop, so it can't make a unique dom element container for the react application");var o="single-spa-application:".concat(a);return function(){var s=document.getElementById(o);return s||((s=document.createElement("div")).id=o,document.body.appendChild(s)),s}}(t))!="function")throw Error("single-spa's dom-element-getter-helpers was given an invalid domElementGetter for application or parcel '".concat(t.name,"'. Expected a function, received ").concat(A(r)));return function(){var n=r(t);if(!(n instanceof HTMLElement))throw Error("single-spa's dom-element-getter-helpers: domElementGetter returned an invalid dom element for application or parcel '".concat(t.name,"'. Expected HTMLElement, received ").concat(A(n)));return n}}var b=null;try{b=fe("react").createContext()}catch(e){}var pe={React:null,ReactDOM:null,ReactDOMClient:null,rootComponent:null,loadRootComponent:null,errorBoundary:null,errorBoundaryClass:null,domElementGetter:null,parcelCanUpdate:!0,suppressComponentDidCatchWarning:!1,domElements:{},renderResults:{},updateResolves:{},unmountResolves:{}};function W(e){if(I(e)!=="object")throw new Error("single-spa-react requires a configuration object");var t,r=E(E({},pe),e);if(!r.React)throw new Error("single-spa-react must be passed opts.React");if(!r.ReactDOM&&!r.ReactDOMClient)throw new Error("single-spa-react must be passed opts.ReactDOM or opts.ReactDOMClient");if(r.renderType||((t=r.ReactDOMClient)!==null&&t!==void 0&&t.createRoot?r.renderType="createRoot":r.renderType="render"),!r.rootComponent&&!r.loadRootComponent)throw new Error("single-spa-react must be passed opts.rootComponent or opts.loadRootComponent");if(r.errorBoundary&&typeof r.errorBoundary!="function")throw Error("The errorBoundary opt for single-spa-react must either be omitted or be a function that returns React elements");!b&&r.React.createContext&&(b=r.React.createContext()),r.SingleSpaRoot=function(a){function o(s){o.displayName="SingleSpaRoot(".concat(s.name,")")}return o.prototype=Object.create(a.React.Component.prototype),o.prototype.componentDidMount=function(){setTimeout(this.props.mountFinished)},o.prototype.componentWillUnmount=function(){setTimeout(this.props.unmountFinished)},o.prototype.render=function(){return setTimeout(this.props.updateFinished),this.props.children},o}(r);var n={bootstrap:ye.bind(null,r),mount:we.bind(null,r),unmount:_e.bind(null,r)};return r.parcelCanUpdate&&(n.update=ge.bind(null,r)),n}function ye(e,t){return e.rootComponent?Promise.resolve():e.loadRootComponent(t).then(function(r){e.rootComponent=r})}function we(e,t){return new Promise(function(r,n){e.suppressComponentDidCatchWarning||!function(i){if(!(i&&typeof i.version=="string"&&i.version.indexOf(".")>=0))return!1;var c=i.version.slice(0,i.version.indexOf("."));try{return Number(c)>=16}catch(l){return!1}}(e.React)||e.errorBoundary||e.errorBoundaryClass||(e.rootComponent.prototype?e.rootComponent.prototype.componentDidCatch||console.warn("single-spa-react: ".concat(t.name||t.appName||t.childAppName,"'s rootComponent should implement componentDidCatch to avoid accidentally unmounting the entire single-spa application.")):console.warn("single-spa-react: ".concat(t.name||t.appName||t.childAppName,"'s rootComponent does not implement an error boundary.  If using a functional component, consider providing an opts.errorBoundary to singleSpaReact(opts).")));var a=z(e,t,function(){r(this)}),o=L(e,t)(),s=function(i){var c=i.reactDom,l=i.renderType,P=i.elementToRender,T=i.domElement,R=c[l];if(typeof R!="function")throw new Error('renderType "'.concat(l,'" did not return a function.'));switch(l){case"createRoot":case"unstable_createRoot":case"createBlockingRoot":case"unstable_createBlockingRoot":var J=R(T);return J.render(P),J;case"hydrateRoot":return R(T,P);case"hydrate":default:return R(P,T),null}}({elementToRender:a,domElement:o,reactDom:x(e),renderType:be(e)});e.domElements[t.name]=o,e.renderResults[t.name]=s})}function _e(e,t){return new Promise(function(r){e.unmountResolves[t.name]=r;var n=e.renderResults[t.name];n&&n.unmount?n.unmount():x(e).unmountComponentAtNode(e.domElements[t.name]),delete e.domElements[t.name],delete e.renderResults[t.name]})}function ge(e,t){return new Promise(function(r){e.updateResolves[t.name]||(e.updateResolves[t.name]=[]),e.updateResolves[t.name].push(r);var n=z(e,t,null),a=e.renderResults[t.name];if(a&&a.render)a.render(n);else{var o=L(e,t)();x(e).render(n,o)}})}function x(e){return e.ReactDOMClient||e.ReactDOM}function be(e){return typeof e.renderType=="function"?e.renderType():e.renderType}function z(e,t,r){var n=e.React.createElement(e.rootComponent,t),a=b?e.React.createElement(b.Provider,{value:t},n):n;return(e.errorBoundary||t.errorBoundary||e.errorBoundaryClass||t.errorBoundaryClass)&&(e.errorBoundaryClass=e.errorBoundaryClass||t.errorBoundaryClass||function(o,s){function i(c){o.React.Component.apply(this,arguments),this.state={caughtError:null,caughtErrorInfo:null},i.displayName="SingleSpaReactErrorBoundary(".concat(c.name,")")}return i.prototype=Object.create(o.React.Component.prototype),i.prototype.render=function(){return this.state.caughtError?(o.errorBoundary||s.errorBoundary)(this.state.caughtError,this.state.caughtErrorInfo,this.props):this.props.children},i.prototype.componentDidCatch=function(c,l){this.setState({caughtError:c,caughtErrorInfo:l})},i}(e,t),a=e.React.createElement(e.errorBoundaryClass,t,a)),a=e.React.createElement(e.SingleSpaRoot,E(E({},t),{},{mountFinished:r,updateFinished:function(){e.updateResolves[t.name]&&(e.updateResolves[t.name].forEach(function(o){return o()}),delete e.updateResolves[t.name])},unmountFinished:function(){e.unmountResolves[t.name]&&(e.unmountResolves[t.name](),delete e.unmountResolves[t.name])}}),a)}var k,v,B;(typeof navigator=="undefined"||!((B=(v=navigator.userAgent)==null?void 0:v.startsWith)!=null&&B.call(v,"Mozilla/5.0 ")))&&(k="oauth4webapi/v3.0.0");function q(e,t){if(e==null)return!1;try{return e instanceof t||Object.getPrototypeOf(e)[Symbol.toStringTag]===t.prototype[Symbol.toStringTag]}catch(r){return!1}}var m="ERR_INVALID_ARG_VALUE",p="ERR_INVALID_ARG_TYPE";function d(e,t,r){let n=new TypeError(e,{cause:r});return Object.assign(n,{code:t}),n}var G=Symbol(),mt=Symbol(),pt=Symbol(),F=Symbol(),yt=Symbol(),wt=Symbol(),_t=Symbol(),Se=new TextEncoder,Re=new TextDecoder;function Ee(e){return typeof e=="string"?Se.encode(e):Re.decode(e)}var $=32768;function ve(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=[];for(let r=0;r<e.byteLength;r+=$)t.push(String.fromCharCode.apply(null,e.subarray(r,r+$)));return btoa(t.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function Pe(e){try{let t=atob(e.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"")),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.charCodeAt(n);return r}catch(t){throw d("The input to be decoded is not correctly encoded.",m,t)}}function V(e){return typeof e=="string"?Pe(e):ve(e)}var O=class extends Error{constructor(r,n){var a;super(r,n);w(this,"code");this.name=this.constructor.name,this.code=Ie,(a=Error.captureStackTrace)==null||a.call(Error,this,this.constructor)}},C=class extends Error{constructor(r,n){var a;super(r,n);w(this,"code");this.name=this.constructor.name,n!=null&&n.code&&(this.code=n==null?void 0:n.code),(a=Error.captureStackTrace)==null||a.call(Error,this,this.constructor)}};function u(e,t,r){return new C(e,{code:t,cause:r})}function Te(e){return!(e===null||typeof e!="object"||Array.isArray(e))}function Q(e){q(e,Headers)&&(e=Object.fromEntries(e.entries()));let t=new Headers(e);if(k&&!t.has("user-agent")&&t.set("user-agent",k),t.has("authorization"))throw d('"options.headers" must not include the "authorization" header name',m);if(t.has("dpop"))throw d('"options.headers" must not include the "dpop" header name',m);return t}function Y(e){if(typeof e=="function"&&(e=e()),!(e instanceof AbortSignal))throw d('"options.signal" must return or be an instance of AbortSignal',p);return e}function Z(e,t){return h(this,null,function*(){if(!(e instanceof URL))throw d('"issuerIdentifier" must be an instance of URL',p);oe(e,(t==null?void 0:t[G])!==!0);let r=new URL(e.href);switch(t==null?void 0:t.algorithm){case void 0:case"oidc":r.pathname=`${r.pathname}/.well-known/openid-configuration`.replace("//","/");break;case"oauth2":r.pathname==="/"?r.pathname=".well-known/oauth-authorization-server":r.pathname=`.well-known/oauth-authorization-server/${r.pathname}`.replace("//","/");break;default:throw d('"options.algorithm" must be "oidc" (default), or "oauth2"',m)}let n=Q(t==null?void 0:t.headers);return n.set("accept","application/json"),((t==null?void 0:t[F])||fetch)(r.href,{body:void 0,headers:Object.fromEntries(n.entries()),method:"GET",redirect:"manual",signal:t!=null&&t.signal?Y(t.signal):void 0})})}function y(e,t,r,n){try{if(typeof e!="string")throw d(`${t} must be a string`,p,n);if(e.length===0)throw d(`${t} must not be empty`,m,n)}catch(a){throw r?u(a.message,r,n):a}}function X(e,t){return h(this,null,function*(){if(!(e instanceof URL)&&e!==M)throw d('"expectedIssuer" must be an instance of URL',p);if(!q(t,Response))throw d('"response" must be an instance of Response',p);if(t.status!==200)throw u('"response" is not a conform Authorization Server Metadata response',$e,t);Fe(t),Ae(t);let r;try{r=yield t.json()}catch(n){throw u('failed to parse "response" body as JSON',We,n)}if(!Te(r))throw u('"response" body must be a top level object',f,{body:r});if(y(r.issuer,'"response" body "issuer" property',f,{body:r}),new URL(r.issuer).href!==e.href&&e!==M)throw u('"response" body "issuer" property does not match the expected value',Be,{expected:e.href,body:r,attribute:"issuer"});return r})}function Ae(e){ke(e,"application/json")}function xe(e,...t){let r='"response" content-type must be ';if(t.length>2){let n=t.pop();r+=`${t.join(", ")}, or ${n}`}else t.length===2?r+=`${t[0]} or ${t[1]}`:r+=t[0];return u(r,ze,e)}function ke(e,t){if(Ue(e)!==t)throw xe(e,t)}function Oe(){return V(crypto.getRandomValues(new Uint8Array(32)))}function ee(){return Oe()}function te(e){return h(this,null,function*(){return y(e,"codeVerifier"),V(yield crypto.subtle.digest("SHA-256",Ee(e)))})}function re(e){if(typeof e!="object"||e===null)throw d('"as" must be an object',p);y(e.issuer,'"as.issuer"')}function ne(e){if(typeof e!="object"||e===null)throw d('"client" must be an object',p);y(e.client_id,'"client.client_id"')}function ae(e){return y(e,'"clientSecret"'),(t,r,n,a)=>{n.set("client_id",r.client_id),n.set("client_secret",e)}}var Ce=URL.parse?(e,t)=>URL.parse(e,t):(e,t)=>{try{return new URL(e,t)}catch(r){return null}};function oe(e,t){if(t&&e.protocol!=="https:")throw u("only requests to HTTPS are allowed",Ke,e);if(e.protocol!=="https:"&&e.protocol!=="http:")throw u("only HTTP and HTTPS requests are allowed",Me,e)}function K(e,t,r,n){let a;if(typeof e!="string"||!(a=Ce(e)))throw u(`authorization server metadata does not contain a valid ${r?`"as.mtls_endpoint_aliases.${t}"`:`"as.${t}"`}`,e===void 0?qe:Ge,{attribute:r?`mtls_endpoint_aliases.${t}`:t});return oe(a,n),a}function je(e,t,r,n){return r&&e.mtls_endpoint_aliases&&t in e.mtls_endpoint_aliases?K(e.mtls_endpoint_aliases[t],t,r,n):K(e[t],t,r,n)}var j=class extends Error{constructor(r,n){var a,o;super(r,n);w(this,"cause");w(this,"code");w(this,"error");w(this,"error_description");this.name=this.constructor.name,this.code=Le,this.cause=n.cause,this.error=n.cause.get("error"),this.error_description=(a=n.cause.get("error_description"))!=null?a:void 0,(o=Error.captureStackTrace)==null||o.call(Error,this,this.constructor)}};function De(e){if(!D.has(e))throw d('"options.DPoP" is not a valid DPoPHandle',m)}var gt=Symbol();function Ue(e){var t;return(t=e.headers.get("content-type"))==null?void 0:t.split(";")[0]}function Ne(e,t,r,n,a,o,s){return h(this,null,function*(){return yield r(e,t,a,o),o.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),((s==null?void 0:s[F])||fetch)(n.href,{body:a,headers:Object.fromEntries(o.entries()),method:"POST",redirect:"manual",signal:s!=null&&s.signal?Y(s.signal):void 0})})}function Je(e,t,r,n,a,o){return h(this,null,function*(){var l;let s=je(e,"token_endpoint",t.use_mtls_endpoint_aliases,(o==null?void 0:o[G])!==!0);a.set("grant_type",n);let i=Q(o==null?void 0:o.headers);i.set("accept","application/json"),(o==null?void 0:o.DPoP)!==void 0&&(De(o.DPoP),yield o.DPoP.addProof(s,i,"POST"));let c=yield Ne(e,t,r,s,a,i,o);return(l=o==null?void 0:o.DPoP)==null||l.cacheNonce(c),c})}var D=new WeakSet;function He(e){return D.add(e),e}function se(e,t,r,n,a,o,s){return h(this,null,function*(){if(re(e),ne(t),!D.has(n))throw d('"callbackParameters" must be an instance of URLSearchParams obtained from "validateAuthResponse()", or "validateJwtAuthResponse()',m);y(a,'"redirectUri"');let i=_(n,"code");if(!i)throw u('no authorization code in "callbackParameters"',f);let c=new URLSearchParams(s==null?void 0:s.additionalParameters);return c.set("redirect_uri",a),c.set("code",i),o!==Ye&&(y(o,'"codeVerifier"'),c.set("code_verifier",o)),Je(e,t,r,"authorization_code",c,s)})}var bt=Symbol(),St=Symbol();var Ie="OAUTH_UNSUPPORTED_OPERATION",Le="OAUTH_AUTHORIZATION_RESPONSE_ERROR";var We="OAUTH_PARSE_ERROR",f="OAUTH_INVALID_RESPONSE";var ze="OAUTH_RESPONSE_IS_NOT_JSON",$e="OAUTH_RESPONSE_IS_NOT_CONFORM",Ke="OAUTH_HTTP_REQUEST_FORBIDDEN",Me="OAUTH_REQUEST_PROTOCOL_FORBIDDEN";var Be="OAUTH_JSON_ATTRIBUTE_COMPARISON_FAILED";var qe="OAUTH_MISSING_SERVER_METADATA",Ge="OAUTH_INVALID_SERVER_METADATA";function Fe(e){if(e.bodyUsed)throw d('"response" body has been used already',m)}var Rt=Symbol();function _(e,t){let{0:r,length:n}=e.getAll(t);if(n>1)throw u(`"${t}" parameter must be provided only once`,f);return r}var Ve=Symbol(),Qe=Symbol();function ie(e,t,r,n){if(re(e),ne(t),r instanceof URL&&(r=r.searchParams),!(r instanceof URLSearchParams))throw d('"parameters" must be an instance of URLSearchParams, or URL',p);if(_(r,"response"))throw u('"parameters" contains a JARM response, use validateJwtAuthResponse() instead of validateAuthResponse()',f,{parameters:r});let a=_(r,"iss"),o=_(r,"state");if(!a&&e.authorization_response_iss_parameter_supported)throw u('response parameter "iss" (issuer) missing',f,{parameters:r});if(a&&a!==e.issuer)throw u('unexpected "iss" (issuer) response parameter value',f,{expected:e.issuer,parameters:r});switch(n){case void 0:case Qe:if(o!==void 0)throw u('unexpected "state" response parameter encountered',f,{expected:void 0,parameters:r});break;case Ve:break;default:if(y(n,'"expectedState" argument'),o!==n)throw u(o===void 0?'response parameter "state" missing':'unexpected "state" response parameter value',f,{expected:n,parameters:r})}if(_(r,"error"))throw new j("authorization response from the server is an error",{cause:r});let i=_(r,"id_token"),c=_(r,"token");if(i!==void 0||c!==void 0)throw new O("implicit and hybrid flows are not supported");return He(new URLSearchParams(r))}var Ye=Symbol(),M=Symbol(),Et=Symbol();var ce=new URL("https://demo.duendesoftware.com/"),Xe="interactive.public.short",et="secret",tt="S256",g,ue="{}",S=new URL(document.querySelector("base").href||"/"),de=()=>h(void 0,null,function*(){let e=new URL(window.location.href);if(g||(g=yield Z(ce).then(a=>X(ce,a))),sessionStorage.getItem("token")&&e.pathname!=="/oauth/logout"){history.replaceState(null,"","/");return}let r={client_id:Xe},n=S+"oauth/callback";if(e.pathname===S.pathname+"oauth/callback"){let a=ie(g,r,e,ue),o=ae(et),s=sessionStorage.getItem("code_verifier");sessionStorage.removeItem("code_verifier");let i=yield se(g,r,o,a,n,s),c=yield i.json().catch(l=>l);!i.ok||c instanceof Error?console.error(c.error):sessionStorage.setItem("token",JSON.stringify(c)),history.replaceState(null,"",S.toString())}else if(e.pathname===S.pathname+"oauth/logout"){let a=JSON.parse(sessionStorage.getItem("token")),o=new URL(g.end_session_endpoint);sessionStorage.removeItem("token");let s=rt({id_token_hint:a.id_token,post_logout_redirect_uri:S.toString()},encodeURIComponent,"&");document.location.href=o.toString()+"?"+s}else{let a=ee();sessionStorage.setItem("code_verifier",a);let o=yield te(a),s=new URL(g.authorization_endpoint);s.searchParams.set("client_id",r.client_id),s.searchParams.set("redirect_uri",n),s.searchParams.set("state",ue),s.searchParams.set("response_type","code"),s.searchParams.set("scope","openid email profile offline_access"),s.searchParams.set("code_challenge",o),s.searchParams.set("code_challenge_method",tt),document.location.href=s.toString()}});function rt(e,t=encodeURIComponent,r="&"){return Object.keys(e).map(n=>`${n}=${t(e[n])}`).join(r)}var at=()=>(de(),U.createElement("div",{id:"oauth"},"Even geduld a.u.b. ...")),N=W({React:U,ReactDOM:nt,rootComponent:at,errorBoundary(e){return U.createElement("div",null,"Fatal error $",e.message," ")}}),Ct=N.bootstrap,jt=N.mount,Dt=N.unmount;export{Ct as bootstrap,N as lifecycles,jt as mount,Dt as unmount};
